<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>FlockStats</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="{{ STATIC_URL }}css/nv.d3.css">

<style>

#detail svg {
  height: 400px;
    width: 100%;
}

#sitespie svg {
  height: 400px;
}

#birdspie svg {
  height: 400px;
}
#overview svg{
    height: 400px;
    width: 100%;
}

</style>
</head>

<body>
<div id="sitespie">
    <svg></svg>
</div>
<div id="birdspie">
    <svg></svg>
</div>

<div id="overview">
    <svg></svg>
</div>

<div id="detail">
  <svg></svg>
</div>
<script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
<script type="text/javascript" src="https://raw.github.com/novus/nvd3/master/nv.d3.min.js"></script>
<script type="text/javascript">
d3.json('/stats/detail', function(data) {
    nv.addGraph(function() {
        var chart = nv.models.multiBarChart()
          .transitionDuration(350)
          .reduceXTicks(true)   //If 'false', every single x-axis tick label will be rendered.
          .rotateLabels(0)      //Angle to rotate x-axis labels.
          .showControls(true)   //Allow user to switch between 'Grouped' and 'Stacked' mode.
          .groupSpacing(0.1)    //Distance between each group of bars.
        ;

        chart.xAxis
            .tickFormat(function(d) { return d3.time.format('%x')(new Date(d)) });

        chart.yAxis
            .tickFormat(d3.format(',1f'));

        d3.select('#detail svg')
            .datum(data)
            .call(chart);

        nv.utils.windowResize(chart.update);

        return chart;
    });

});
d3.json('/stats/eggsbysite', function(data) {
  nv.addGraph(function () {
      var chart = nv.models.pieChart()
              .x(function (d) {
                  return d.label
              })
              .y(function (d) {
                  return d.value
              })
              .showLabels(true);

      d3.select("#sitespie svg")
              .datum(data)
              .transition().duration(1200)
              .call(chart);

      return chart;
  });
});
d3.json('/stats/eggsbybird', function(data) {
  nv.addGraph(function () {
      var chart = nv.models.pieChart()
              .x(function (d) {
                  return d.label
              })
              .y(function (d) {
                  return d.value
              })
              .showLabels(true);

      d3.select("#birdspie svg")
              .datum(data)
              .transition().duration(1200)
              .call(chart);

      return chart;
  });
});

d3.json('/stats/overview', function(data) {
    nv.addGraph(function () {
        var chart = nv.models.linePlusBarChart()
                        .margin({top: 30, right: 60, bottom: 50, left: 70})
                        .x(function (d, i) {
                            return d[0]
                        })
                        .y(function (d) {
                            return d[1]
                        })
                        .color(d3.scale.category10().range())
                ;

        chart.xAxis
            .axisLabel('Date')
            .tickFormat(function(d) {
                  return d3.time.format('%x')(
                          new Date(d)
                  ) });


        chart.y1Axis
                .axisLabel('Qty')
                .tickFormat(d3.format(',f'));

        chart.y2Axis
                .axisLabel('Total Gms')
                .tickFormat(function (d) {
                    return  d3.format(',f')(d)
                });

        chart.bars.forceY([0]);

        d3.select('#overview svg')
                .datum(data)
                .transition().duration(500)
                .call(chart)
        ;

        nv.utils.windowResize(chart.update);

        return chart;
    });
});

</script>
</body>
</html>